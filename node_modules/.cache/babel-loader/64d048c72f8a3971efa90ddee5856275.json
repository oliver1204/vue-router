{"remainingRequest":"/Users/olifer/Documents/goooooooo/vue-router/node_modules/babel-loader/lib/index.js!/Users/olifer/Documents/goooooooo/vue-router/src/vue-router/history/base.js","dependencies":[{"path":"/Users/olifer/Documents/goooooooo/vue-router/src/vue-router/history/base.js","mtime":1613490329689},{"path":"/Users/olifer/Documents/goooooooo/vue-router/node_modules/cache-loader/dist/cjs.js","mtime":1612936944194},{"path":"/Users/olifer/Documents/goooooooo/vue-router/node_modules/babel-loader/lib/index.js","mtime":1612936944192}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5tYXRjaC5qcyI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiL1VzZXJzL29saWZlci9Eb2N1bWVudHMvZ29vb29vb29vL3Z1ZS1yb3V0ZXIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvVXNlcnMvb2xpZmVyL0RvY3VtZW50cy9nb29vb29vb28vdnVlLXJvdXRlci9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX29iamVjdFNwcmVhZCBmcm9tICIvVXNlcnMvb2xpZmVyL0RvY3VtZW50cy9nb29vb29vb28vdnVlLXJvdXRlci9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCB7IGNyZWF0ZSB9IGZyb20gJ2xvZGFzaCc7CmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVSb3V0ZShyZWNvcmQsIGxvY2F0aW9uKSB7CiAgdmFyIHJlcyA9IFtdOyAvLyDlpoLmnpzljLnphY3liLDkuobot6/lvoTvvIzpnIDopoHlsIbov5nkuKrot6/lvoTmlL7ov5vljrsKCiAgaWYgKHJlY29yZCkgewogICAgd2hpbGUgKHJlY29yZCkgewogICAgICByZXMudW5zaGlmdChyZWNvcmQpOwogICAgICByZWNvcmQgPSByZWNvcmQucGFyZW50OwogICAgfQogIH0KCiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgbG9jYXRpb24pLCB7fSwgewogICAgbWF0Y2hlZDogcmVzCiAgfSk7Cn0gLy8g5omn6KGM6ZKp5a2Q5Ye95pWwIOaJp+ihjOW8guatpeWHveaVsAoKZnVuY3Rpb24gcnVuUXVldWUocXVldWUsIGl0ZXJhdG9yLCBjYikgewogIGZ1bmN0aW9uIHN0ZXAoaW5kZXgpIHsKICAgIGlmIChpbmRleCA9PSBxdWV1ZS5sZW5ndGgpIHJldHVybiBjYigpOyAvLyDmm7TmlrDop4blm74KCiAgICB2YXIgaG9vayA9IHF1ZXVlW2luZGV4XTsKICAgIGl0ZXJhdG9yKGhvb2ssIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHN0ZXAoaW5kZXggKyAxKTsKICAgIH0pOwogIH0KCiAgc3RlcCgwKTsgLy8g5LiA5q2l5LiA5q2l6LWwCn0KCnZhciBIaXN0b3J5ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBIaXN0b3J5KHJvdXRlcikgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEhpc3RvcnkpOwoKICAgIHRoaXMucm91dGVyID0gcm91dGVyOwogICAgdGhpcy5jdXJyZW50ID0gY3JlYXRlUm91dGUobnVsbCwgewogICAgICBwYXRoOiAnLycKICAgIH0pOyAvLyB2dWUg6ZKp5a2Q5Ye95pWwCgogICAgdGhpcy5iZWZvcmVFYWNocyA9IFtdOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEhpc3RvcnksIFt7CiAgICBrZXk6ICJzZXR1cExpc3RlbmVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0dXBMaXN0ZW5lcnMoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignaGFzaGNoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpcy50cmFuc2l0aW9uVG8od2luZG93LmxvY2F0aW9uLmhhc2guc2xpY2UoMSkpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ0cmFuc2l0aW9uVG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHRyYW5zaXRpb25Ubyhsb2NhdGlvbiwgY2FsbGJhY2spIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgciA9IHRoaXMucm91dGVyLm1hdGNoKGxvY2F0aW9uKTsKCiAgICAgIGlmIChsb2NhdGlvbiA9PSB0aGlzLmN1cnJlbnQucGF0aCAmJiByLm1hdGNoZWQubGVuZ3RoID09IHRoaXMuY3VycmVudC5tYXRjaGVkLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTsgLy8g5L6d5qyh5omn6KGM6ZKp5a2Q5Ye95pWwCgogICAgICB2YXIgcXVldWUgPSB0aGlzLnJvdXRlci5iZWZvcmVFYWNoczsKCiAgICAgIHZhciBpdGVyYXRvciA9IGZ1bmN0aW9uIGl0ZXJhdG9yKGhvb2ssIG5leHQpIHsKICAgICAgICAvLyDosIPnlKjnlKjmiLfnmoTmlrnms5Ug5Lyg5YWlbmV4dAogICAgICAgIGhvb2soX3RoaXMyLmN1cnJlbnQsIHIsIG5leHQpOwogICAgICB9OwoKICAgICAgcnVuUXVldWUocXVldWUsIGl0ZXJhdG9yLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMyLnVwZGF0ZVJvdXRlKHIpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVSb3V0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlUm91dGUocikgewogICAgICB0aGlzLmN1cnJlbnQgPSByOyAvLyDlsIblvZPliY3ot6/lvoTmm7TmlrAKCiAgICAgIHRoaXMuY2IgJiYgdGhpcy5jYihyKTsgLy8g5ZGK6K+JX3JvdXRl5bGe5oCn5p2l5pu05paw77yMIOabtOaWsOWQjuinhuWbvuWQjumHjeaWsOabtOaWsAogICAgfQogIH0sIHsKICAgIGtleTogImxpc3RlbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbGlzdGVuKGNiKSB7CiAgICAgIHRoaXMuY2IgPSBjYjsKICAgIH0KICB9XSk7CgogIHJldHVybiBIaXN0b3J5Owp9KCk7CgpleHBvcnQgeyBIaXN0b3J5IGFzIGRlZmF1bHQgfTs="},{"version":3,"sources":["/Users/olifer/Documents/goooooooo/vue-router/src/vue-router/history/base.js"],"names":["create","createRoute","record","location","res","unshift","parent","matched","runQueue","queue","iterator","cb","step","index","length","hook","History","router","current","path","beforeEachs","window","addEventListener","transitionTo","hash","slice","callback","r","match","next","updateRoute"],"mappings":";;;;;;AAAA,SAASA,MAAT,QAAuB,QAAvB;AAEA,OAAO,SAASC,WAAT,CAAqBC,MAArB,EAA6BC,QAA7B,EAAuC;AAC5C,MAAIC,GAAG,GAAG,EAAV,CAD4C,CAC9B;;AAEd,MAAIF,MAAJ,EAAY;AACV,WAAOA,MAAP,EAAe;AACbE,MAAAA,GAAG,CAACC,OAAJ,CAAYH,MAAZ;AACAA,MAAAA,MAAM,GAAGA,MAAM,CAACI,MAAhB;AACD;AACF;;AAED,yCACKH,QADL;AAEEI,IAAAA,OAAO,EAAEH;AAFX;AAID,C,CACD;;AACA,SAASI,QAAT,CAAkBC,KAAlB,EAAyBC,QAAzB,EAAmCC,EAAnC,EAAuC;AACrC,WAASC,IAAT,CAAcC,KAAd,EAAqB;AACnB,QAAIA,KAAK,IAAIJ,KAAK,CAACK,MAAnB,EAA2B,OAAOH,EAAE,EAAT,CADR,CACqB;;AACxC,QAAII,IAAI,GAAGN,KAAK,CAACI,KAAD,CAAhB;AAEAH,IAAAA,QAAQ,CAACK,IAAD,EAAO;AAAA,aAAMH,IAAI,CAACC,KAAK,GAAG,CAAT,CAAV;AAAA,KAAP,CAAR;AACD;;AACDD,EAAAA,IAAI,CAAC,CAAD,CAAJ,CAPqC,CAO5B;AACV;;IACoBI,O;AACnB,mBAAYC,MAAZ,EAAoB;AAAA;;AAClB,SAAKA,MAAL,GAAcA,MAAd;AACA,SAAKC,OAAL,GAAejB,WAAW,CAAC,IAAD,EAAO;AAC/BkB,MAAAA,IAAI,EAAE;AADyB,KAAP,CAA1B,CAFkB,CAMlB;;AACA,SAAKC,WAAL,GAAmB,EAAnB;AACD;;;;WACD,0BAAiB;AAAA;;AACfC,MAAAA,MAAM,CAACC,gBAAP,CAAwB,YAAxB,EAAsC,YAAM;AAC1C,QAAA,KAAI,CAACC,YAAL,CAAkBF,MAAM,CAAClB,QAAP,CAAgBqB,IAAhB,CAAqBC,KAArB,CAA2B,CAA3B,CAAlB;AACD,OAFD;AAGD;;;WACD,sBAAatB,QAAb,EAAuBuB,QAAvB,EAAiC;AAAA;;AAC/B,UAAIC,CAAC,GAAG,KAAKV,MAAL,CAAYW,KAAZ,CAAkBzB,QAAlB,CAAR;;AACA,UACEA,QAAQ,IAAI,KAAKe,OAAL,CAAaC,IAAzB,IACAQ,CAAC,CAACpB,OAAF,CAAUO,MAAV,IAAoB,KAAKI,OAAL,CAAaX,OAAb,CAAqBO,MAF3C,EAGE;AACA;AACD;;AACDY,MAAAA,QAAQ,IAAIA,QAAQ,EAApB,CAR+B,CAS/B;;AACA,UAAIjB,KAAK,GAAG,KAAKQ,MAAL,CAAYG,WAAxB;;AACA,UAAMV,QAAQ,GAAG,SAAXA,QAAW,CAACK,IAAD,EAAOc,IAAP,EAAgB;AAC/B;AACAd,QAAAA,IAAI,CAAC,MAAI,CAACG,OAAN,EAAeS,CAAf,EAAkBE,IAAlB,CAAJ;AACD,OAHD;;AAIArB,MAAAA,QAAQ,CAACC,KAAD,EAAQC,QAAR,EAAkB,YAAM;AAC9B,QAAA,MAAI,CAACoB,WAAL,CAAiBH,CAAjB;AACD,OAFO,CAAR;AAGD;;;WACD,qBAAYA,CAAZ,EAAe;AACb,WAAKT,OAAL,GAAeS,CAAf,CADa,CACK;;AAClB,WAAKhB,EAAL,IAAW,KAAKA,EAAL,CAAQgB,CAAR,CAAX,CAFa,CAEU;AACxB;;;WACD,gBAAOhB,EAAP,EAAW;AACT,WAAKA,EAAL,GAAUA,EAAV;AACD;;;;;;SAxCkBK,O","sourcesContent":["import { create } from 'lodash';\n\nexport function createRoute(record, location) {\n  let res = []; // 如果匹配到了路径，需要将这个路径放进去\n\n  if (record) {\n    while (record) {\n      res.unshift(record);\n      record = record.parent;\n    }\n  }\n\n  return {\n    ...location,\n    matched: res,\n  };\n}\n// 执行钩子函数 执行异步函数\nfunction runQueue(queue, iterator, cb) {\n  function step(index) {\n    if (index == queue.length) return cb(); // 更新视图\n    let hook = queue[index];\n\n    iterator(hook, () => step(index + 1));\n  }\n  step(0); // 一步一步走\n}\nexport default class History {\n  constructor(router) {\n    this.router = router;\n    this.current = createRoute(null, {\n      path: '/',\n    });\n\n    // vue 钩子函数\n    this.beforeEachs = [];\n  }\n  setupListeners() {\n    window.addEventListener('hashchange', () => {\n      this.transitionTo(window.location.hash.slice(1));\n    });\n  }\n  transitionTo(location, callback) {\n    let r = this.router.match(location);\n    if (\n      location == this.current.path &&\n      r.matched.length == this.current.matched.length\n    ) {\n      return;\n    }\n    callback && callback();\n    // 依次执行钩子函数\n    let queue = this.router.beforeEachs;\n    const iterator = (hook, next) => {\n      // 调用用户的方法 传入next\n      hook(this.current, r, next);\n    };\n    runQueue(queue, iterator, () => {\n      this.updateRoute(r);\n    });\n  }\n  updateRoute(r) {\n    this.current = r; // 将当前路径更新\n    this.cb && this.cb(r); // 告诉_route属性来更新， 更新后视图后重新更新\n  }\n  listen(cb) {\n    this.cb = cb;\n  }\n}\n"]}]}