{"remainingRequest":"/Users/olifer/Documents/goooooooo/vue-router/node_modules/babel-loader/lib/index.js!/Users/olifer/Documents/goooooooo/vue-router/src/vue-router/history/base.js","dependencies":[{"path":"/Users/olifer/Documents/goooooooo/vue-router/src/vue-router/history/base.js","mtime":1613489741724},{"path":"/Users/olifer/Documents/goooooooo/vue-router/node_modules/cache-loader/dist/cjs.js","mtime":1612936944194},{"path":"/Users/olifer/Documents/goooooooo/vue-router/node_modules/babel-loader/lib/index.js","mtime":1612936944192}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5tYXRjaC5qcyI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiL1VzZXJzL29saWZlci9Eb2N1bWVudHMvZ29vb29vb29vL3Z1ZS1yb3V0ZXIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvVXNlcnMvb2xpZmVyL0RvY3VtZW50cy9nb29vb29vb28vdnVlLXJvdXRlci9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX29iamVjdFNwcmVhZCBmcm9tICIvVXNlcnMvb2xpZmVyL0RvY3VtZW50cy9nb29vb29vb28vdnVlLXJvdXRlci9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCB7IGNyZWF0ZSB9IGZyb20gJ2xvZGFzaCc7CmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVSb3V0ZShyZWNvcmQsIGxvY2F0aW9uKSB7CiAgdmFyIHJlcyA9IFtdOyAvLyDlpoLmnpzljLnphY3liLDkuobot6/lvoTvvIzpnIDopoHlsIbov5nkuKrot6/lvoTmlL7ov5vljrsKCiAgaWYgKHJlY29yZCkgewogICAgd2hpbGUgKHJlY29yZCkgewogICAgICByZXMudW5zaGlmdChyZWNvcmQpOwogICAgICByZWNvcmQgPSByZWNvcmQucGFyZW50OwogICAgfQogIH0KCiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgbG9jYXRpb24pLCB7fSwgewogICAgbWF0Y2hlZDogcmVzCiAgfSk7Cn0KCnZhciBIaXN0b3J5ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBIaXN0b3J5KHJvdXRlcikgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEhpc3RvcnkpOwoKICAgIHRoaXMucm91dGVyID0gcm91dGVyOwogICAgdGhpcy5jdXJyZW50ID0gY3JlYXRlUm91dGUobnVsbCwgewogICAgICBwYXRoOiAnLycKICAgIH0pOyAvLyB2dWUg6ZKp5a2Q5Ye95pWwCgogICAgdGhpcy5iZWZvcmVFYWNocyA9IFtdOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEhpc3RvcnksIFt7CiAgICBrZXk6ICJzZXR1cExpc3RlbmVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0dXBMaXN0ZW5lcnMoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignaGFzaGNoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpcy50cmFuc2l0aW9uVG8od2luZG93LmxvY2F0aW9uLmhhc2guc2xpY2UoMSkpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ0cmFuc2l0aW9uVG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHRyYW5zaXRpb25Ubyhsb2NhdGlvbiwgY2FsbGJhY2spIHsKICAgICAgdmFyIHIgPSB0aGlzLnJvdXRlci5tYXRjaChsb2NhdGlvbik7CgogICAgICBpZiAobG9jYXRpb24gPT0gdGhpcy5jdXJyZW50LnBhdGggJiYgci5tYXRjaGVkLmxlbmd0aCA9PSB0aGlzLmN1cnJlbnQubWF0Y2hlZC5sZW5ndGgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7CiAgICAgIHRoaXMudXBkYXRlUm91dGUocik7CiAgICB9CiAgfSwgewogICAga2V5OiAidXBkYXRlUm91dGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZVJvdXRlKHIpIHsKICAgICAgdGhpcy5jdXJyZW50ID0gcjsgLy8g5bCG5b2T5YmN6Lev5b6E5pu05pawCgogICAgICB0aGlzLmNiICYmIHRoaXMuY2Iocik7IC8vIOWRiuiviV9yb3V0ZeWxnuaAp+adpeabtOaWsO+8jCDmm7TmlrDlkI7op4blm77lkI7ph43mlrDmm7TmlrAKICAgIH0KICB9LCB7CiAgICBrZXk6ICJsaXN0ZW4iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGxpc3RlbihjYikgewogICAgICB0aGlzLmNiID0gY2I7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gSGlzdG9yeTsKfSgpOwoKZXhwb3J0IHsgSGlzdG9yeSBhcyBkZWZhdWx0IH07"},{"version":3,"sources":["/Users/olifer/Documents/goooooooo/vue-router/src/vue-router/history/base.js"],"names":["create","createRoute","record","location","res","unshift","parent","matched","History","router","current","path","beforeEachs","window","addEventListener","transitionTo","hash","slice","callback","r","match","length","updateRoute","cb"],"mappings":";;;;;;AAAA,SAASA,MAAT,QAAuB,QAAvB;AAEA,OAAO,SAASC,WAAT,CAAqBC,MAArB,EAA6BC,QAA7B,EAAuC;AAC5C,MAAIC,GAAG,GAAG,EAAV,CAD4C,CAC9B;;AAEd,MAAIF,MAAJ,EAAY;AACV,WAAOA,MAAP,EAAe;AACbE,MAAAA,GAAG,CAACC,OAAJ,CAAYH,MAAZ;AACAA,MAAAA,MAAM,GAAGA,MAAM,CAACI,MAAhB;AACD;AACF;;AAED,yCACKH,QADL;AAEEI,IAAAA,OAAO,EAAEH;AAFX;AAID;;IACoBI,O;AACnB,mBAAYC,MAAZ,EAAoB;AAAA;;AAClB,SAAKA,MAAL,GAAcA,MAAd;AACA,SAAKC,OAAL,GAAeT,WAAW,CAAC,IAAD,EAAO;AAC/BU,MAAAA,IAAI,EAAE;AADyB,KAAP,CAA1B,CAFkB,CAMlB;;AACA,SAAKC,WAAL,GAAmB,EAAnB;AACD;;;;WACD,0BAAiB;AAAA;;AACfC,MAAAA,MAAM,CAACC,gBAAP,CAAwB,YAAxB,EAAsC,YAAM;AAC1C,QAAA,KAAI,CAACC,YAAL,CAAkBF,MAAM,CAACV,QAAP,CAAgBa,IAAhB,CAAqBC,KAArB,CAA2B,CAA3B,CAAlB;AACD,OAFD;AAGD;;;WACD,sBAAad,QAAb,EAAuBe,QAAvB,EAAiC;AAC/B,UAAIC,CAAC,GAAG,KAAKV,MAAL,CAAYW,KAAZ,CAAkBjB,QAAlB,CAAR;;AACA,UACEA,QAAQ,IAAI,KAAKO,OAAL,CAAaC,IAAzB,IACAQ,CAAC,CAACZ,OAAF,CAAUc,MAAV,IAAoB,KAAKX,OAAL,CAAaH,OAAb,CAAqBc,MAF3C,EAGE;AACA;AACD;;AACDH,MAAAA,QAAQ,IAAIA,QAAQ,EAApB;AACA,WAAKI,WAAL,CAAiBH,CAAjB;AACD;;;WACD,qBAAYA,CAAZ,EAAe;AACb,WAAKT,OAAL,GAAeS,CAAf,CADa,CACK;;AAElB,WAAKI,EAAL,IAAW,KAAKA,EAAL,CAAQJ,CAAR,CAAX,CAHa,CAGU;AACxB;;;WACD,gBAAOI,EAAP,EAAW;AACT,WAAKA,EAAL,GAAUA,EAAV;AACD;;;;;;SAjCkBf,O","sourcesContent":["import { create } from 'lodash';\n\nexport function createRoute(record, location) {\n  let res = []; // 如果匹配到了路径，需要将这个路径放进去\n\n  if (record) {\n    while (record) {\n      res.unshift(record);\n      record = record.parent;\n    }\n  }\n\n  return {\n    ...location,\n    matched: res,\n  };\n}\nexport default class History {\n  constructor(router) {\n    this.router = router;\n    this.current = createRoute(null, {\n      path: '/',\n    });\n\n    // vue 钩子函数\n    this.beforeEachs = [];\n  }\n  setupListeners() {\n    window.addEventListener('hashchange', () => {\n      this.transitionTo(window.location.hash.slice(1));\n    });\n  }\n  transitionTo(location, callback) {\n    let r = this.router.match(location);\n    if (\n      location == this.current.path &&\n      r.matched.length == this.current.matched.length\n    ) {\n      return;\n    }\n    callback && callback();\n    this.updateRoute(r);\n  }\n  updateRoute(r) {\n    this.current = r; // 将当前路径更新\n\n    this.cb && this.cb(r); // 告诉_route属性来更新， 更新后视图后重新更新\n  }\n  listen(cb) {\n    this.cb = cb;\n  }\n}\n"]}]}